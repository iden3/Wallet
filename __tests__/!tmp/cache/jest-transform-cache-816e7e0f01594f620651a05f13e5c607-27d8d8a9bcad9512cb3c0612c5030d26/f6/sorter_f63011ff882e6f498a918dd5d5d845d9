b812352a83859cc59afce4a50fb3ae8f
"use strict";

(function () {
  var enterModule = require('react-hot-loader').enterModule;

  enterModule && enterModule(module);
})();

var addSorting = function () {
  "use strict";

  var cols,
      currentSort = {
    index: 0,
    desc: false
  }; // returns the summary table element

  function getTable() {
    return document.querySelector('.coverage-summary');
  } // returns the thead element of the summary table


  function getTableHeader() {
    return getTable().querySelector('thead tr');
  } // returns the tbody element of the summary table


  function getTableBody() {
    return getTable().querySelector('tbody');
  } // returns the th element for nth column


  function getNthColumn(n) {
    return getTableHeader().querySelectorAll('th')[n];
  } // loads all columns


  function loadColumns() {
    var colNodes = getTableHeader().querySelectorAll('th'),
        colNode,
        cols = [],
        col,
        i;

    for (i = 0; i < colNodes.length; i += 1) {
      colNode = colNodes[i];
      col = {
        key: colNode.getAttribute('data-col'),
        sortable: !colNode.getAttribute('data-nosort'),
        type: colNode.getAttribute('data-type') || 'string'
      };
      cols.push(col);

      if (col.sortable) {
        col.defaultDescSort = col.type === 'number';
        colNode.innerHTML = colNode.innerHTML + '<span class="sorter"></span>';
      }
    }

    return cols;
  } // attaches a data attribute to every tr element with an object
  // of data values keyed by column name


  function loadRowData(tableRow) {
    var tableCols = tableRow.querySelectorAll('td'),
        colNode,
        col,
        data = {},
        i,
        val;

    for (i = 0; i < tableCols.length; i += 1) {
      colNode = tableCols[i];
      col = cols[i];
      val = colNode.getAttribute('data-value');

      if (col.type === 'number') {
        val = Number(val);
      }

      data[col.key] = val;
    }

    return data;
  } // loads all row data


  function loadData() {
    var rows = getTableBody().querySelectorAll('tr'),
        i;

    for (i = 0; i < rows.length; i += 1) {
      rows[i].data = loadRowData(rows[i]);
    }
  } // sorts the table using the data for the ith column


  function sortByIndex(index, desc) {
    var key = cols[index].key,
        sorter = function sorter(a, b) {
      a = a.data[key];
      b = b.data[key];
      return a < b ? -1 : a > b ? 1 : 0;
    },
        finalSorter = sorter,
        tableBody = document.querySelector('.coverage-summary tbody'),
        rowNodes = tableBody.querySelectorAll('tr'),
        rows = [],
        i;

    if (desc) {
      finalSorter = function finalSorter(a, b) {
        return -1 * sorter(a, b);
      };
    }

    for (i = 0; i < rowNodes.length; i += 1) {
      rows.push(rowNodes[i]);
      tableBody.removeChild(rowNodes[i]);
    }

    rows.sort(finalSorter);

    for (i = 0; i < rows.length; i += 1) {
      tableBody.appendChild(rows[i]);
    }
  } // removes sort indicators for current column being sorted


  function removeSortIndicators() {
    var col = getNthColumn(currentSort.index),
        cls = col.className;
    cls = cls.replace(/ sorted$/, '').replace(/ sorted-desc$/, '');
    col.className = cls;
  } // adds sort indicators for current column being sorted


  function addSortIndicators() {
    getNthColumn(currentSort.index).className += currentSort.desc ? ' sorted-desc' : ' sorted';
  } // adds event listeners for all sorter widgets


  function enableUI() {
    var i,
        el,
        ithSorter = function ithSorter(i) {
      var col = cols[i];
      return function () {
        var desc = col.defaultDescSort;

        if (currentSort.index === i) {
          desc = !currentSort.desc;
        }

        sortByIndex(i, desc);
        removeSortIndicators();
        currentSort.index = i;
        currentSort.desc = desc;
        addSortIndicators();
      };
    };

    for (i = 0; i < cols.length; i += 1) {
      if (cols[i].sortable) {
        // add the click event handler on the th so users
        // dont have to click on those tiny arrows
        el = getNthColumn(i).querySelector('.sorter').parentElement;

        if (el.addEventListener) {
          el.addEventListener('click', ithSorter(i));
        } else {
          el.attachEvent('onclick', ithSorter(i));
        }
      }
    }
  } // adds sorting functionality to the UI


  return function () {
    if (!getTable()) {
      return;
    }

    cols = loadColumns();
    loadData(cols);
    addSortIndicators();
    enableUI();
  };
}();

window.addEventListener('load', addSorting);
;

(function () {
  var reactHotLoader = require('react-hot-loader').default;

  var leaveModule = require('react-hot-loader').leaveModule;

  if (!reactHotLoader) {
    return;
  }

  reactHotLoader.register(addSorting, "addSorting", "/home/charly/Uniclau/Iden3/web-wallet/__tests__/!reports/lcov-report/sorter.js");
  leaveModule(module);
})();

;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvcnRlci5qcyJdLCJuYW1lcyI6WyJhZGRTb3J0aW5nIiwiY29scyIsImN1cnJlbnRTb3J0IiwiaW5kZXgiLCJkZXNjIiwiZ2V0VGFibGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJnZXRUYWJsZUhlYWRlciIsImdldFRhYmxlQm9keSIsImdldE50aENvbHVtbiIsIm4iLCJxdWVyeVNlbGVjdG9yQWxsIiwibG9hZENvbHVtbnMiLCJjb2xOb2RlcyIsImNvbE5vZGUiLCJjb2wiLCJpIiwibGVuZ3RoIiwia2V5IiwiZ2V0QXR0cmlidXRlIiwic29ydGFibGUiLCJ0eXBlIiwicHVzaCIsImRlZmF1bHREZXNjU29ydCIsImlubmVySFRNTCIsImxvYWRSb3dEYXRhIiwidGFibGVSb3ciLCJ0YWJsZUNvbHMiLCJkYXRhIiwidmFsIiwiTnVtYmVyIiwibG9hZERhdGEiLCJyb3dzIiwic29ydEJ5SW5kZXgiLCJzb3J0ZXIiLCJhIiwiYiIsImZpbmFsU29ydGVyIiwidGFibGVCb2R5Iiwicm93Tm9kZXMiLCJyZW1vdmVDaGlsZCIsInNvcnQiLCJhcHBlbmRDaGlsZCIsInJlbW92ZVNvcnRJbmRpY2F0b3JzIiwiY2xzIiwiY2xhc3NOYW1lIiwicmVwbGFjZSIsImFkZFNvcnRJbmRpY2F0b3JzIiwiZW5hYmxlVUkiLCJlbCIsIml0aFNvcnRlciIsInBhcmVudEVsZW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiYXR0YWNoRXZlbnQiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsSUFBSUEsVUFBVSxHQUFJLFlBQVk7QUFDMUI7O0FBQ0EsTUFBSUMsSUFBSjtBQUFBLE1BQ0lDLFdBQVcsR0FBRztBQUNWQyxJQUFBQSxLQUFLLEVBQUUsQ0FERztBQUVWQyxJQUFBQSxJQUFJLEVBQUU7QUFGSSxHQURsQixDQUYwQixDQVExQjs7QUFDQSxXQUFTQyxRQUFULEdBQW9CO0FBQUUsV0FBT0MsUUFBUSxDQUFDQyxhQUFULENBQXVCLG1CQUF2QixDQUFQ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Q0FBbkM7QUFDSDtBQUNKO0FBQ0o7QUFDSixHQWhKeUIsQ0FpSjFCOzs7QUFDQSxTQUFPLFlBQVk7QUFDZixRQUFJLENBQUNaLFFBQVEsRUFBYixFQUFpQjtBQUNiO0FBQ0g7O0FBQ0RKLElBQUFBLElBQUksR0FBR1ksV0FBVyxFQUFsQjtBQUNBbUIsSUFBQUEsUUFBUSxDQUFDL0IsSUFBRCxDQUFSO0FBQ0ErQyxJQUFBQSxpQkFBaUI7QUFDakJDLElBQUFBLFFBQVE7QUFDWCxHQVJEO0FBU0gsQ0EzSmdCLEVBQWpCOztBQTZKQU0sTUFBTSxDQUFDRixnQkFBUCxDQUF3QixNQUF4QixFQUFnQ3JELFVBQWhDOzs7Ozs7Ozs7Ozs7MEJBN0pJQSxVIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFkZFNvcnRpbmcgPSAoZnVuY3Rpb24gKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBjb2xzLFxuICAgICAgICBjdXJyZW50U29ydCA9IHtcbiAgICAgICAgICAgIGluZGV4OiAwLFxuICAgICAgICAgICAgZGVzYzogZmFsc2VcbiAgICAgICAgfTtcblxuICAgIC8vIHJldHVybnMgdGhlIHN1bW1hcnkgdGFibGUgZWxlbWVudFxuICAgIGZ1bmN0aW9uIGdldFRhYmxlKCkgeyByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvdmVyYWdlLXN1bW1hcnknKTsgfVxuICAgIC8vIHJldHVybnMgdGhlIHRoZWFkIGVsZW1lbnQgb2YgdGhlIHN1bW1hcnkgdGFibGVcbiAgICBmdW5jdGlvbiBnZXRUYWJsZUhlYWRlcigpIHsgcmV0dXJuIGdldFRhYmxlKCkucXVlcnlTZWxlY3RvcigndGhlYWQgdHInKTsgfVxuICAgIC8vIHJldHVybnMgdGhlIHRib2R5IGVsZW1lbnQgb2YgdGhlIHN1bW1hcnkgdGFibGVcbiAgICBmdW5jdGlvbiBnZXRUYWJsZUJvZHkoKSB7IHJldHVybiBnZXRUYWJsZSgpLnF1ZXJ5U2VsZWN0b3IoJ3Rib2R5Jyk7IH1cbiAgICAvLyByZXR1cm5zIHRoZSB0aCBlbGVtZW50IGZvciBudGggY29sdW1uXG4gICAgZnVuY3Rpb24gZ2V0TnRoQ29sdW1uKG4pIHsgcmV0dXJuIGdldFRhYmxlSGVhZGVyKCkucXVlcnlTZWxlY3RvckFsbCgndGgnKVtuXTsgfVxuXG4gICAgLy8gbG9hZHMgYWxsIGNvbHVtbnNcbiAgICBmdW5jdGlvbiBsb2FkQ29sdW1ucygpIHtcbiAgICAgICAgdmFyIGNvbE5vZGVzID0gZ2V0VGFibGVIZWFkZXIoKS5xdWVyeVNlbGVjdG9yQWxsKCd0aCcpLFxuICAgICAgICAgICAgY29sTm9kZSxcbiAgICAgICAgICAgIGNvbHMgPSBbXSxcbiAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgIGk7XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvbE5vZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb2xOb2RlID0gY29sTm9kZXNbaV07XG4gICAgICAgICAgICBjb2wgPSB7XG4gICAgICAgICAgICAgICAga2V5OiBjb2xOb2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1jb2wnKSxcbiAgICAgICAgICAgICAgICBzb3J0YWJsZTogIWNvbE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLW5vc29ydCcpLFxuICAgICAgICAgICAgICAgIHR5cGU6IGNvbE5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLXR5cGUnKSB8fCAnc3RyaW5nJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbHMucHVzaChjb2wpO1xuICAgICAgICAgICAgaWYgKGNvbC5zb3J0YWJsZSkge1xuICAgICAgICAgICAgICAgIGNvbC5kZWZhdWx0RGVzY1NvcnQgPSBjb2wudHlwZSA9PT0gJ251bWJlcic7XG4gICAgICAgICAgICAgICAgY29sTm9kZS5pbm5lckhUTUwgPSBjb2xOb2RlLmlubmVySFRNTCArICc8c3BhbiBjbGFzcz1cInNvcnRlclwiPjwvc3Bhbj4nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb2xzO1xuICAgIH1cbiAgICAvLyBhdHRhY2hlcyBhIGRhdGEgYXR0cmlidXRlIHRvIGV2ZXJ5IHRyIGVsZW1lbnQgd2l0aCBhbiBvYmplY3RcbiAgICAvLyBvZiBkYXRhIHZhbHVlcyBrZXllZCBieSBjb2x1bW4gbmFtZVxuICAgIGZ1bmN0aW9uIGxvYWRSb3dEYXRhKHRhYmxlUm93KSB7XG4gICAgICAgIHZhciB0YWJsZUNvbHMgPSB0YWJsZVJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0ZCcpLFxuICAgICAgICAgICAgY29sTm9kZSxcbiAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgIGRhdGEgPSB7fSxcbiAgICAgICAgICAgIGksXG4gICAgICAgICAgICB2YWw7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCB0YWJsZUNvbHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbE5vZGUgPSB0YWJsZUNvbHNbaV07XG4gICAgICAgICAgICBjb2wgPSBjb2xzW2ldO1xuICAgICAgICAgICAgdmFsID0gY29sTm9kZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTtcbiAgICAgICAgICAgIGlmIChjb2wudHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICB2YWwgPSBOdW1iZXIodmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRhdGFbY29sLmtleV0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIC8vIGxvYWRzIGFsbCByb3cgZGF0YVxuICAgIGZ1bmN0aW9uIGxvYWREYXRhKCkge1xuICAgICAgICB2YXIgcm93cyA9IGdldFRhYmxlQm9keSgpLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJyksXG4gICAgICAgICAgICBpO1xuXG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICByb3dzW2ldLmRhdGEgPSBsb2FkUm93RGF0YShyb3dzW2ldKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBzb3J0cyB0aGUgdGFibGUgdXNpbmcgdGhlIGRhdGEgZm9yIHRoZSBpdGggY29sdW1uXG4gICAgZnVuY3Rpb24gc29ydEJ5SW5kZXgoaW5kZXgsIGRlc2MpIHtcbiAgICAgICAgdmFyIGtleSA9IGNvbHNbaW5kZXhdLmtleSxcbiAgICAgICAgICAgIHNvcnRlciA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgYSA9IGEuZGF0YVtrZXldO1xuICAgICAgICAgICAgICAgIGIgPSBiLmRhdGFba2V5XTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYSA8IGIgPyAtMSA6IGEgPiBiID8gMSA6IDA7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmluYWxTb3J0ZXIgPSBzb3J0ZXIsXG4gICAgICAgICAgICB0YWJsZUJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY292ZXJhZ2Utc3VtbWFyeSB0Ym9keScpLFxuICAgICAgICAgICAgcm93Tm9kZXMgPSB0YWJsZUJvZHkucXVlcnlTZWxlY3RvckFsbCgndHInKSxcbiAgICAgICAgICAgIHJvd3MgPSBbXSxcbiAgICAgICAgICAgIGk7XG5cbiAgICAgICAgaWYgKGRlc2MpIHtcbiAgICAgICAgICAgIGZpbmFsU29ydGVyID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLTEgKiBzb3J0ZXIoYSwgYik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJvd05vZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICByb3dzLnB1c2gocm93Tm9kZXNbaV0pO1xuICAgICAgICAgICAgdGFibGVCb2R5LnJlbW92ZUNoaWxkKHJvd05vZGVzW2ldKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJvd3Muc29ydChmaW5hbFNvcnRlcik7XG5cbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIHRhYmxlQm9keS5hcHBlbmRDaGlsZChyb3dzW2ldKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyByZW1vdmVzIHNvcnQgaW5kaWNhdG9ycyBmb3IgY3VycmVudCBjb2x1bW4gYmVpbmcgc29ydGVkXG4gICAgZnVuY3Rpb24gcmVtb3ZlU29ydEluZGljYXRvcnMoKSB7XG4gICAgICAgIHZhciBjb2wgPSBnZXROdGhDb2x1bW4oY3VycmVudFNvcnQuaW5kZXgpLFxuICAgICAgICAgICAgY2xzID0gY29sLmNsYXNzTmFtZTtcblxuICAgICAgICBjbHMgPSBjbHMucmVwbGFjZSgvIHNvcnRlZCQvLCAnJykucmVwbGFjZSgvIHNvcnRlZC1kZXNjJC8sICcnKTtcbiAgICAgICAgY29sLmNsYXNzTmFtZSA9IGNscztcbiAgICB9XG4gICAgLy8gYWRkcyBzb3J0IGluZGljYXRvcnMgZm9yIGN1cnJlbnQgY29sdW1uIGJlaW5nIHNvcnRlZFxuICAgIGZ1bmN0aW9uIGFkZFNvcnRJbmRpY2F0b3JzKCkge1xuICAgICAgICBnZXROdGhDb2x1bW4oY3VycmVudFNvcnQuaW5kZXgpLmNsYXNzTmFtZSArPSBjdXJyZW50U29ydC5kZXNjID8gJyBzb3J0ZWQtZGVzYycgOiAnIHNvcnRlZCc7XG4gICAgfVxuICAgIC8vIGFkZHMgZXZlbnQgbGlzdGVuZXJzIGZvciBhbGwgc29ydGVyIHdpZGdldHNcbiAgICBmdW5jdGlvbiBlbmFibGVVSSgpIHtcbiAgICAgICAgdmFyIGksXG4gICAgICAgICAgICBlbCxcbiAgICAgICAgICAgIGl0aFNvcnRlciA9IGZ1bmN0aW9uIGl0aFNvcnRlcihpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNvbCA9IGNvbHNbaV07XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVzYyA9IGNvbC5kZWZhdWx0RGVzY1NvcnQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTb3J0LmluZGV4ID09PSBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gIWN1cnJlbnRTb3J0LmRlc2M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc29ydEJ5SW5kZXgoaSwgZGVzYyk7XG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZVNvcnRJbmRpY2F0b3JzKCk7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTb3J0LmluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFNvcnQuZGVzYyA9IGRlc2M7XG4gICAgICAgICAgICAgICAgICAgIGFkZFNvcnRJbmRpY2F0b3JzKCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIGZvciAoaSA9MCA7IGkgPCBjb2xzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBpZiAoY29sc1tpXS5zb3J0YWJsZSkge1xuICAgICAgICAgICAgICAgIC8vIGFkZCB0aGUgY2xpY2sgZXZlbnQgaGFuZGxlciBvbiB0aGUgdGggc28gdXNlcnNcbiAgICAgICAgICAgICAgICAvLyBkb250IGhhdmUgdG8gY2xpY2sgb24gdGhvc2UgdGlueSBhcnJvd3NcbiAgICAgICAgICAgICAgICBlbCA9IGdldE50aENvbHVtbihpKS5xdWVyeVNlbGVjdG9yKCcuc29ydGVyJykucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgICAgICBpZiAoZWwuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGl0aFNvcnRlcihpKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZWwuYXR0YWNoRXZlbnQoJ29uY2xpY2snLCBpdGhTb3J0ZXIoaSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBhZGRzIHNvcnRpbmcgZnVuY3Rpb25hbGl0eSB0byB0aGUgVUlcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIWdldFRhYmxlKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb2xzID0gbG9hZENvbHVtbnMoKTtcbiAgICAgICAgbG9hZERhdGEoY29scyk7XG4gICAgICAgIGFkZFNvcnRJbmRpY2F0b3JzKCk7XG4gICAgICAgIGVuYWJsZVVJKCk7XG4gICAgfTtcbn0pKCk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgYWRkU29ydGluZyk7XG4iXX0=