be8f4693d931a4f343c89c75095b9f42
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireWildcard(require("react"));

var _redux = require("redux");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactRouterDom = require("react-router-dom");

var _memoizeOne = _interopRequireDefault(require("memoize-one"));

var _base_components = require("base_components");

var _views = require("views");

var ROUTES = _interopRequireWildcard(require("constants/routes"));

var _icons = require("constants/icons");

var _utils = require("helpers/utils");

require("./nav-bar.scss");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }

(function () {
  var enterModule = require('react-hot-loader').enterModule;

  enterModule && enterModule(module);
})();

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Navigation bar to use it in the header. It has a desktop menu and a mobile menu depending on
 * the breakpoint, calculated via css. It has on the left the menu for the different views
 * and on the right a settings/user menu. Once is collapsed (when is accessed via a tablet or phone)
 * we have all in the same menu.
 */
var NavBar =
/*#__PURE__*/
function (_Component) {
  _inherits(NavBar, _Component);

  function NavBar() {
    var _getPrototypeOf2;

    var _this;

    _classCallCheck(this, NavBar);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(NavBar)).call.apply(_getPrototypeOf2, [this].concat(args)));

    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), "memoizedPath", (0, _memoizeOne.default)(function (key) {
      return (0, _utils.capitalizeFirstLetter)(key.replace(/\//g, ''));
    }));

    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), "state", {
      collapsed: true,
      mobileMenuIcon: _icons.BURGER_MENU_UNFOLD,
      isCameraVisible: false
    });

    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), "toggleCameraVisibility", function () {
      _this.setState(function (prevState) {
        return {
          isCameraVisible: !prevState.isCameraVisible
        };
      });
    });

    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), "toggleMenuMobileIcon", function () {
      _this.setState(function (prevState) {
        return {
          mobileMenuIcon: prevState.mobileMenuIcon === _icons.BURGER_MENU_FOLD ? _icons.BURGER_MENU_UNFOLD : _icons.BURGER_MENU_FOLD,
          collapsed: !prevState.collapsed
        };
      });
    });

    return _this;
  }

  _createClass(NavBar, [{
    key: "_getMenuItems",

    /**
     * Compose all the Menu with their links and routes
     * @returns {element[]} An array of React nodes (MenuItem)
     * @private
     */
    value: function _getMenuItems() {
      var _this2 = this;

      var items = [];
      Object.keys(ROUTES).forEach(function (route) {
        var _route = ROUTES[route]; // in every Link created, we set the replace prop to true
        // because when clicking the link will replace the
        // current entry in the history stack instead of adding a new one.
        // If not a Warning is triggered when we click more than one time
        // in the current link because we are adding the same entry once and again.
        // Please, FMI, visit: https://reacttraining.com/react-router/web/api/Link/replace-bool

        if (_route.ORDER !== -1) {
          items.push(_react.default.createElement(_base_components.MenuItem, {
            key: _route.KEY,
            onClick: _this2.toggleMenuMobileIcon
          }, _react.default.createElement(_reactRouterDom.Link, {
            to: _route.MAIN,
            replace: true
          }), _react.default.createElement(_base_components.Icon, {
            type: _route.ICON
          }), _route.KEY));
        }
      });
      return items;
    }
    /**
     * Set the submenu for the setting/user menu. Valid for desktop and mobile size.
     * We will have an icon, the name of the current identity and a
     * badge in the top of the icon with the number of notifications
     * @returns {element} React node with the settings SubMenu
     */

  }, {
    key: "_getSettingSubmenu",
    value: function _getSettingSubmenu() {
      var title = _react.default.createElement("span", null, _react.default.createElement(_base_components.Badge, {
        count: 5
      }, _react.default.createElement(_base_components.Icon, {
        type: _icons.IDENTITY
      })), "Identity A");

      return _react.default.createElement(_base_components.SubMenu, {
        title: title
      }, _react.default.createElement(_base_components.MenuItem, null, "Identity 2"), _react.default.createElement(_base_components.MenuItem, null, "Identity 3"), _react.default.createElement(_base_components.MenuItem, null, _react.default.createElement(_base_components.Button, {
        type: "primary",
        htmlType: "button"
      }, _react.default.createElement(_reactRouterDom.Link, {
        to: ROUTES.IDENTITIES.MAIN,
        replace: true
      }, "Manage my identities"))));
    }
  }, {
    key: "render",
    value: function render() {
      var menuItems = this._getMenuItems();

      var settingsMenu = this._getSettingSubmenu();

      var selectedMenuItem = this.memoizedPath(this.props.location.pathname);
      return _react.default.createElement("div", {
        className: "i3-ww-nav-bar"
      }, _react.default.createElement("div", {
        className: "i3-ww-nav-bar-mobile"
      }, _react.default.createElement(_base_components.Button, {
        className: "i3-ww-nav-bar-mobile__menu-button",
        type: "primary",
        htmlType: "button",
        onClick: this.toggleMenuMobileIcon,
        onKeyUp: this.toggleMenuMobileIcon
      }, _react.default.createElement(_base_components.Icon, {
        type: this.state.mobileMenuIcon
      })), _react.default.createElement(_base_components.Menu, {
        defaultSelectedKeys: [selectedMenuItem],
        mode: "inline",
        inlineCollapsed: this.state.collapsed
      }, !this.state.collapsed && menuItems, !this.state.collapsed && settingsMenu)), _react.default.createElement("div", {
        className: "i3-ww-nav-bar__header-items"
      }, _react.default.createElement("div", {
        className: "i3-ww-nav-bar-desktop"
      }, _react.default.createElement(_base_components.Menu, {
        mode: "horizontal",
        selectedKeys: [selectedMenuItem]
      }, menuItems)), _react.default.createElement("div", {
        className: "i3-ww-nav-bar__cam-button"
      }, _react.default.createElement(_base_components.Menu, {
        mode: "horizontal",
        onClick: this.toggleCameraVisibility
      }, _react.default.createElement(_base_components.MenuItem, null, _react.default.createElement(_base_components.Icon, {
        type: "camera-o"
      })))), _react.default.createElement("div", {
        className: "i3-ww-nav-bar-settings"
      }, _react.default.createElement(_base_components.Menu, {
        mode: "horizontal"
      }, settingsMenu))), _react.default.createElement(_views.QRScanner, {
        isCameraVisible: this.state.isCameraVisible,
        toggleCameraVisibility: this.toggleCameraVisibility
      }));
    }
  }, {
    key: "__reactstandin__regenerateByEval",
    // @ts-ignore
    value: function __reactstandin__regenerateByEval(key, code) {
      // @ts-ignore
      this[key] = eval(code);
    }
  }]);

  return NavBar;
}(_react.Component);

_defineProperty(NavBar, "propTypes", {
  // from withRouter Hoc
  location: _propTypes.default.object.isRequired
});

var _default = (0, _redux.compose)(_reactRouterDom.withRouter)(NavBar);

var _default2 = _default;
exports.default = _default2;
;

(function () {
  var reactHotLoader = require('react-hot-loader').default;

  var leaveModule = require('react-hot-loader').leaveModule;

  if (!reactHotLoader) {
    return;
  }

  reactHotLoader.register(NavBar, "NavBar", "/home/charly/Uniclau/Iden3/web-wallet/src/views/nav-bar/containers/nav-bar.js");
  reactHotLoader.register(_default, "default", "/home/charly/Uniclau/Iden3/web-wallet/src/views/nav-bar/containers/nav-bar.js");
  leaveModule(module);
})();

;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5hdi1iYXIuanMiXSwibmFtZXMiOlsiTmF2QmFyIiwia2V5IiwicmVwbGFjZSIsImNvbGxhcHNlZCIsIm1vYmlsZU1lbnVJY29uIiwiQlVSR0VSX01FTlVfVU5GT0xEIiwiaXNDYW1lcmFWaXNpYmxlIiwic2V0U3RhdGUiLCJwcmV2U3RhdGUiLCJCVVJHRVJfTUVOVV9GT0xEIiwiaXRlbXMiLCJPYmplY3QiLCJrZXlzIiwiUk9VVEVTIiwiZm9yRWFjaCIsInJvdXRlIiwiX3JvdXRlIiwiT1JERVIiLCJwdXNoIiwiS0VZIiwidG9nZ2xlTWVudU1vYmlsZUljb24iLCJNQUlOIiwiSUNPTiIsInRpdGxlIiwiSURFTlRJVFkiLCJJREVOVElUSUVTIiwibWVudUl0ZW1zIiwiX2dldE1lbnVJdGVtcyIsInNldHRpbmdzTWVudSIsIl9nZXRTZXR0aW5nU3VibWVudSIsInNlbGVjdGVkTWVudUl0ZW0iLCJtZW1vaXplZFBhdGgiLCJwcm9wcyIsImxvY2F0aW9uIiwicGF0aG5hbWUiLCJzdGF0ZSIsInRvZ2dsZUNhbWVyYVZpc2liaWxpdHkiLCJDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJvYmplY3QiLCJpc1JlcXVpcmVkIiwid2l0aFJvdXRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUlBOztBQUNBOztBQVFBOztBQUNBOztBQUNBOztBQUtBOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBOzs7Ozs7SUFNTUEsTTs7Ozs7Ozs7Ozs7Ozs7Ozs7OzJGQUVXLHlCQUFXLFVBQUFDLEdBQUc7QUFBQSxhQUFJLGtDQUFzQkEsR0FBRyxDQUFDQyxPQUFKLENBQVksS0FBWixFQUFtQixFQUFuQixDQUF0QixDQUFKO0FBQUEsS0FBZCxDOztvRkFPUDtBQUNOQyxNQUFBQSxTQUFTLEVBQUUsSUFETDtBQUVOQyxNQUFBQSxjQUFjLEVBQUVDLHlCQUZWO0FBR05DLE1BQUFBLGVBQWUsRUFBRTtBQUhYLEs7O3FH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OztlQTBKTixvQkFDYkMsMEJBRGEsRUFFYnpDLE1BRmEsQzs7Ozs7Ozs7Ozs7Ozs7OzBCQTlKVEEsTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBjb21wb3NlIH0gZnJvbSAncmVkdXgnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7XG4gIExpbmssXG4gIHdpdGhSb3V0ZXIsXG59IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IG1lbW9pemVPbmUgZnJvbSAnbWVtb2l6ZS1vbmUnO1xuaW1wb3J0IHtcbiAgQmFkZ2UsXG4gIEJ1dHRvbixcbiAgSWNvbixcbiAgTWVudSxcbiAgTWVudUl0ZW0sXG4gIFN1Yk1lbnUsXG59IGZyb20gJ2Jhc2VfY29tcG9uZW50cyc7XG5pbXBvcnQgeyBRUlNjYW5uZXIgfSBmcm9tICd2aWV3cyc7XG5pbXBvcnQgKiBhcyBST1VURVMgZnJvbSAnY29uc3RhbnRzL3JvdXRlcyc7XG5pbXBvcnQge1xuICBCVVJHRVJfTUVOVV9GT0xELFxuICBCVVJHRVJfTUVOVV9VTkZPTEQsXG4gIElERU5USVRZLFxufSBmcm9tICdjb25zdGFudHMvaWNvbnMnO1xuaW1wb3J0IHsgY2FwaXRhbGl6ZUZpcnN0TGV0dGVyIH0gZnJvbSAnaGVscGVycy91dGlscyc7XG5cbmltcG9ydCAnLi9uYXYtYmFyLnNjc3MnO1xuXG4vKipcbiAqIE5hdmlnYXRpb24gYmFyIHRvIHVzZSBpdCBpbiB0aGUgaGVhZGVyLiBJdCBoYXMgYSBkZXNrdG9wIG1lbnUgYW5kIGEgbW9iaWxlIG1lbnUgZGVwZW5kaW5nIG9uXG4gKiB0aGUgYnJlYWtwb2ludCwgY2FsY3VsYXRlZCB2aWEgY3NzLiBJdCBoYXMgb24gdGhlIGxlZnQgdGhlIG1lbnUgZm9yIHRoZSBkaWZmZXJlbnQgdmlld3NcbiAqIGFuZCBvbiB0aGUgcmlnaHQgYSBzZXR0aW5ncy91c2VyIG1lbnUuIE9uY2UgaXMgY29sbGFwc2VkICh3aGVuIGlzIGFjY2Vzc2VkIHZpYSBhIHRhYmxldCBvciBwaG9uZSlcbiAqIHdlIGhhdmUgYWxsIGluIHRoZSBzYW1lIG1lbnUuXG4gKi9cbmNsYXNzIE5hdkJhciBleHRlbmRzIENvbXBvbmVudCB7XG4gIC8vIGNoYW5nZSB0aGUgc2VsZWN0ZWQgbWVudSBpdGVtIHdoZW4gbG9jYXRpb24gaGFzIGNoYW5nZWQgKHdoZW4gdXNlciBoYXMgaW50cm9kdWNlZCBieSBoYW5kIHRoZSBVUkwgaS5lLilcbiAgbWVtb2l6ZWRQYXRoID0gbWVtb2l6ZU9uZShrZXkgPT4gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKGtleS5yZXBsYWNlKC9cXC8vZywgJycpKSk7XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvLyBmcm9tIHdpdGhSb3V0ZXIgSG9jXG4gICAgbG9jYXRpb246IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgfTtcblxuICBzdGF0ZSA9IHtcbiAgICBjb2xsYXBzZWQ6IHRydWUsXG4gICAgbW9iaWxlTWVudUljb246IEJVUkdFUl9NRU5VX1VORk9MRCxcbiAgICBpc0NhbWVyYVZpc2libGU6IGZhbHNlLFxuICB9O1xuXG4gIHRvZ2dsZUNhbWVyYVZpc2liaWxpdHkgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZShcbiAgICAgIHByZXZTdGF0ZSA9PiAoeyBpc0NhbWVyYVZpc2libGU6ICFwcmV2U3RhdGUuaXNDYW1lcmFWaXNpYmxlIH0pLFxuICAgICk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFRvZ2dsZSB0aGUgaWNvbiBvZiB0aGUgJ2J1cmdlcicgaWNvbiBzaG93biBpbiB0YWJsZXQgYW5kIG1vYmlsZSBzaXplIHRvIGluZGljYXRlIHRvIG9wZW4gaXQgbyBjbG9zZSBpdFxuICAgKi9cbiAgdG9nZ2xlTWVudU1vYmlsZUljb24gPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZShwcmV2U3RhdGUgPT4gKFxuICAgICAge1xuICAgICAgICBtb2JpbGVNZW51SWNvbjogcHJldlN0YXRlLm1vYmlsZU1lbnVJY29uID09PSBCVVJHRVJfTUVOVV9GT0xEID8gQlVSR0VSX01FTlVfVU5GT0xEIDogQlVSR0VSX01FTlVfRk9MRCxcbiAgICAgICAgY29sbGFwc2VkOiAhcHJldlN0YXRlLmNvbGxhcHNlZCxcbiAgICAgIH0pKTtcbiAgfTtcblxuICAvKipcbiAgICogQ29tcG9zZSBhbGwgdGhlIE1lbnUgd2l0aCB0aGVpciBsaW5rcyBhbmQgcm91dGVzXG4gICAqIEByZXR1cm5zIHtlbGVtZW50W119IEFuIGFycmF5IG9mIFJlYWN0IG5vZGVzIChNZW51SXRlbSlcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9nZXRNZW51SXRlbXMoKSB7XG4gICAgY29uc3QgaXRlbXMgPSBbXTtcblxuICAgIE9iamVjdC5rZXlzKFJPVVRFUykuZm9yRWFjaCgocm91dGUpID0+IHtcbiAgICAgIGNvbnN0IF9yb3V0ZSA9IFJPVVRFU1tyb3V0ZV07XG5cbiAgICAgIC8vIGluIGV2ZXJ5IExpbmsgY3JlYXRlZCwgd2Ugc2V0IHRoZSByZXBsYWNlIHByb3AgdG8gdHJ1ZVxuICAgICAgLy8gYmVjYXVzZSB3aGVuIGNsaWNraW5nIHRoZSBsaW5rIHdpbGwgcmVwbGFjZSB0aGVcbiAgICAgIC8vIGN1cnJlbnQgZW50cnkgaW4gdGhlIGhpc3Rvcnkgc3RhY2sgaW5zdGVhZCBvZiBhZGRpbmcgYSBuZXcgb25lLlxuICAgICAgLy8gSWYgbm90IGEgV2FybmluZyBpcyB0cmlnZ2VyZWQgd2hlbiB3ZSBjbGljayBtb3JlIHRoYW4gb25lIHRpbWVcbiAgICAgIC8vIGluIHRoZSBjdXJyZW50IGxpbmsgYmVjYXVzZSB3ZSBhcmUgYWRkaW5nIHRoZSBzYW1lIGVudHJ5IG9uY2UgYW5kIGFnYWluLlxuICAgICAgLy8gUGxlYXNlLCBGTUksIHZpc2l0OiBodHRwczovL3JlYWN0dHJhaW5pbmcuY29tL3JlYWN0LXJvdXRlci93ZWIvYXBpL0xpbmsvcmVwbGFjZS1ib29sXG4gICAgICBpZiAoX3JvdXRlLk9SREVSICE9PSAtMSkge1xuICAgICAgICBpdGVtcy5wdXNoKFxuICAgICAgICAgIDxNZW51SXRlbVxuICAgICAgICAgICAga2V5PXtfcm91dGUuS0VZfVxuICAgICAgICAgICAgb25DbGljaz17dGhpcy50b2dnbGVNZW51TW9iaWxlSWNvbn0+XG4gICAgICAgICAgICA8TGluayB0bz17X3JvdXRlLk1BSU59IHJlcGxhY2UgLz5cbiAgICAgICAgICAgIDxJY29uIHR5cGU9e19yb3V0ZS5JQ09OfSAvPlxuICAgICAgICAgICAge19yb3V0ZS5LRVl9XG4gICAgICAgICAgPC9NZW51SXRlbT4sXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaXRlbXM7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzdWJtZW51IGZvciB0aGUgc2V0dGluZy91c2VyIG1lbnUuIFZhbGlkIGZvciBkZXNrdG9wIGFuZCBtb2JpbGUgc2l6ZS5cbiAgICogV2Ugd2lsbCBoYXZlIGFuIGljb24sIHRoZSBuYW1lIG9mIHRoZSBjdXJyZW50IGlkZW50aXR5IGFuZCBhXG4gICAqIGJhZGdlIGluIHRoZSB0b3Agb2YgdGhlIGljb24gd2l0aCB0aGUgbnVtYmVyIG9mIG5vdGlmaWNhdGlvbnNcbiAgICogQHJldHVybnMge2VsZW1lbnR9IFJlYWN0IG5vZGUgd2l0aCB0aGUgc2V0dGluZ3MgU3ViTWVudVxuICAgKi9cbiAgX2dldFNldHRpbmdTdWJtZW51KCkge1xuICAgIGNvbnN0IHRpdGxlID0gKFxuICAgICAgPHNwYW4+XG4gICAgICAgIDxCYWRnZSBjb3VudD17NX0+XG4gICAgICAgICAgPEljb24gdHlwZT17SURFTlRJVFl9IC8+XG4gICAgICAgIDwvQmFkZ2U+XG4gICAgICAgIElkZW50aXR5IEFcbiAgICAgIDwvc3Bhbj5cbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxTdWJNZW51IHRpdGxlPXt0aXRsZX0+XG4gICAgICAgIDxNZW51SXRlbT5cbiAgICAgICAgICBJZGVudGl0eSAyXG4gICAgICAgIDwvTWVudUl0ZW0+XG4gICAgICAgIDxNZW51SXRlbT5cbiAgICAgICAgICBJZGVudGl0eSAzXG4gICAgICAgIDwvTWVudUl0ZW0+XG4gICAgICAgIDxNZW51SXRlbT5cbiAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICB0eXBlPVwicHJpbWFyeVwiXG4gICAgICAgICAgICBodG1sVHlwZT1cImJ1dHRvblwiPlxuICAgICAgICAgICAgPExpbmsgdG89e1JPVVRFUy5JREVOVElUSUVTLk1BSU59IHJlcGxhY2U+XG4gICAgICAgICAgICAgIE1hbmFnZSBteSBpZGVudGl0aWVzXG4gICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvTWVudUl0ZW0+XG4gICAgICA8L1N1Yk1lbnU+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCBtZW51SXRlbXMgPSB0aGlzLl9nZXRNZW51SXRlbXMoKTtcbiAgICBjb25zdCBzZXR0aW5nc01lbnUgPSB0aGlzLl9nZXRTZXR0aW5nU3VibWVudSgpO1xuICAgIGNvbnN0IHNlbGVjdGVkTWVudUl0ZW0gPSB0aGlzLm1lbW9pemVkUGF0aCh0aGlzLnByb3BzLmxvY2F0aW9uLnBhdGhuYW1lKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImkzLXd3LW5hdi1iYXJcIj5cbiAgICAgICAgey8qIENvbGxhcHNlZCBtZW51IGluIHNtYWxsIGRldmljZXMgKi99XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaTMtd3ctbmF2LWJhci1tb2JpbGVcIj5cbiAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJpMy13dy1uYXYtYmFyLW1vYmlsZV9fbWVudS1idXR0b25cIlxuICAgICAgICAgICAgdHlwZT1cInByaW1hcnlcIlxuICAgICAgICAgICAgaHRtbFR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgb25DbGljaz17dGhpcy50b2dnbGVNZW51TW9iaWxlSWNvbn1cbiAgICAgICAgICAgIG9uS2V5VXA9e3RoaXMudG9nZ2xlTWVudU1vYmlsZUljb259PlxuICAgICAgICAgICAgPEljb24gdHlwZT17dGhpcy5zdGF0ZS5tb2JpbGVNZW51SWNvbn0gLz5cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA8TWVudVxuICAgICAgICAgICAgZGVmYXVsdFNlbGVjdGVkS2V5cz17W3NlbGVjdGVkTWVudUl0ZW1dfVxuICAgICAgICAgICAgbW9kZT1cImlubGluZVwiXG4gICAgICAgICAgICBpbmxpbmVDb2xsYXBzZWQ9e3RoaXMuc3RhdGUuY29sbGFwc2VkfT5cbiAgICAgICAgICAgIHsgIXRoaXMuc3RhdGUuY29sbGFwc2VkICYmIG1lbnVJdGVtcyB9XG4gICAgICAgICAgICB7ICF0aGlzLnN0YXRlLmNvbGxhcHNlZCAmJiBzZXR0aW5nc01lbnUgfVxuICAgICAgICAgIDwvTWVudT5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIHsvKiBSZWd1bGFyIG1lbnUgZm9yIGRlc2t0b3AgKi99XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaTMtd3ctbmF2LWJhcl9faGVhZGVyLWl0ZW1zXCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJpMy13dy1uYXYtYmFyLWRlc2t0b3BcIj5cbiAgICAgICAgICAgIDxNZW51XG4gICAgICAgICAgICAgIG1vZGU9XCJob3Jpem9udGFsXCJcbiAgICAgICAgICAgICAgc2VsZWN0ZWRLZXlzPXtbc2VsZWN0ZWRNZW51SXRlbV19PlxuICAgICAgICAgICAgICB7IG1lbnVJdGVtcyB9XG4gICAgICAgICAgICA8L01lbnU+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJpMy13dy1uYXYtYmFyX19jYW0tYnV0dG9uXCI+XG4gICAgICAgICAgICA8TWVudSBtb2RlPVwiaG9yaXpvbnRhbFwiIG9uQ2xpY2s9e3RoaXMudG9nZ2xlQ2FtZXJhVmlzaWJpbGl0eX0+XG4gICAgICAgICAgICAgIDxNZW51SXRlbT5cbiAgICAgICAgICAgICAgICA8SWNvbiB0eXBlPVwiY2FtZXJhLW9cIiAvPlxuICAgICAgICAgICAgICA8L01lbnVJdGVtPlxuICAgICAgICAgICAgPC9NZW51PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaTMtd3ctbmF2LWJhci1zZXR0aW5nc1wiPlxuICAgICAgICAgICAgPE1lbnUgbW9kZT1cImhvcml6b250YWxcIj5cbiAgICAgICAgICAgICAgeyBzZXR0aW5nc01lbnUgfVxuICAgICAgICAgICAgPC9NZW51PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgey8qIEJveCB0byBzaG93IGNhbWVyYSBmb3IgcmVhZGluZyBRUiAqL31cbiAgICAgICAgPFFSU2Nhbm5lclxuICAgICAgICAgIGlzQ2FtZXJhVmlzaWJsZT17dGhpcy5zdGF0ZS5pc0NhbWVyYVZpc2libGV9XG4gICAgICAgICAgdG9nZ2xlQ2FtZXJhVmlzaWJpbGl0eT17dGhpcy50b2dnbGVDYW1lcmFWaXNpYmlsaXR5fSAvPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjb21wb3NlKFxuICB3aXRoUm91dGVyLFxuKShOYXZCYXIpO1xuIl19